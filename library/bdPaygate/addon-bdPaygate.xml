<?xml version="1.0" encoding="utf-8"?>
<addon addon_id="bdPaygate" title="[bd] Paygates" version_string="1.5.2" version_id="1050203" url="" install_callback_class="bdPaygate_Installer" install_callback_method="install" uninstall_callback_class="bdPaygate_Installer" uninstall_callback_method="uninstall">
  <admin_navigation>
    <navigation navigation_id="bdPaygate_logs" parent_navigation_id="logs" display_order="9999" link="logs/bdpaygate" admin_permission_id="viewLogs" debug_only="0" hide_no_children="0"/>
  </admin_navigation>
  <admin_permissions/>
  <admin_style_properties/>
  <admin_templates>
    <template title="bdpaygate.css"><![CDATA[.FilterList .listItem.error h4,
.FilterList .listItem.error:hover h4 {
	background: red;
}

	.FilterList .listItem.error a,
	.FilterList .listItem.error .secondRow,
	.FilterList .listItem.error .faint {
		color: white;
	}

.FilterList .listItem.other h4,
.FilterList .listItem.other:hover h4 {
	background: yellow;
}

]]></template>
    <template title="bdpaygate_log_clear"><![CDATA[<xen:title>{xen:phrase bdpaygate_log_clear}</xen:title>
<xen:require css="delete_confirmation.css" />

<xen:form action="{xen:adminlink 'logs/bdpaygate/clear'}" class="deleteConfirmForm formOverlay">

	<p>{xen:phrase bdpaytate_sure_you_want_to_clear_log}</p>
	
	<xen:submitunit save="{xen:phrase bdpaygate_log_clear}" />
	
	<input type="hidden" name="_xfConfirm" value="1" />
</xen:form>]]></template>
    <template title="bdpaygate_log_list"><![CDATA[<xen:title>{xen:phrase bdpaygate_logs}</xen:title>

<xen:if is="{$entries}"><xen:topctrl><a href="{xen:adminlink logs/bdpaygate/clear}" class="button OverlayTrigger">{xen:phrase bdpaygate_log_clear}</a></xen:topctrl></xen:if>

<xen:require css="filter_list.css" />
<xen:require css="bdpaygate.css" />
<xen:require js="js/xenforo/filter_list.js" />

<xen:if is="{$entries}">

	<div class="section">
	
		<h2 class="subHeading">
			{xen:phrase bdpaygate_logs}
		</h2>
	
		<ol class="FilterList secondRow">
			<xen:foreach loop="$entries" value="$entry">
				<xen:listitem id="{$entry.error_id}"
					href="{xen:adminlink logs/bdpaygate, '', 'id={$entry.log_id}'}"
					linkclass="OverlayTrigger"
					class="{$entry.log_type}">
					<xen:label>{$entry.log_message}
						<span class="secondRow">
							<xen:datetime time="{$entry.log_date}" class="faint" />
							-
							{$entry.processor}
							({$entry.log_type})
						</span>
					</xen:label>
				</xen:listitem>
			</xen:foreach>
		</ol>
	
		<p class="sectionFooter">{xen:phrase showing_x_of_y_items, 'count=<span class="FilterListCount">{xen:count $entries}</span>', 'total={xen:number $total}'}</p>
	
	</div>
		
	<xen:adminpagenav page="{$page}" perpage="{$perPage}" total="{$total}" link="logs/bdpaygate" />

<xen:else />
	<div class="noResults">{xen:phrase bdpaygate_no_transaction_have_been_logged}</div>
</xen:if>]]></template>
    <template title="bdpaygate_log_view"><![CDATA[<xen:title>{xen:phrase bdpaygate_log}</xen:title>

<div class="section">
	<div class="overlayScroll">
		<table width="100%">
		<tr>
			<th class="subHeading">{xen:phrase bdpaygate_log_processor_info}</th>
		</tr>
		<tr>
			<td class="primaryContent">
				<span class="dimmed">{$entry.processor}:</span> {$entry.transaction_id}
				<div class="muted"><xen:datetime time="{$entry.log_date}" /></div>
			</td>
		</tr>
		<tr>
			<th class="subHeading">{xen:phrase bdpaygate_log_result}</th>
		</tr>
		<tr>
			<td class="primaryContent">{xen:string nl2br, $entry.log_message} ({$entry.log_type})</td>
		</tr>
		<tr>
			<th class="subHeading">{xen:phrase bdpaygate_log_details}</th>
		</tr>
		<tr>
			<td>
				<table width="100%">
					<xen:foreach loop="$entry.logDetails" key="$key" value="$value">
						<tr>
							<td class="primaryContent">{$key}</td>
							<td class="primaryContent">
								<xen:if is="is_array({$value})">
									{xen:helper dump, $value}
								<xen:else />
									{$value}
								</xen:if>
							</td>
						</tr>
					</xen:foreach>
				</table>
			</td>
		</tr>
		</table>
	</div>
</div>]]></template>
  </admin_templates>
  <admin_template_modifications>
    <modification template="resource_category_edit" modification_key="bdpaygate_resource_category_edit" description="Insert commercial local option." execution_order="10" enabled="1" action="str_replace">
      <find><![CDATA[<xen:option name="allow_local" selected="{$category.allow_local}">{xen:phrase uploaded_file}</xen:option>]]></find>
      <replace><![CDATA[$0

<xen:option name="bdpaygate_allow_commercial_local" selected="{$category.bdpaygate_allow_commercial_local}">
	{xen:phrase bdpaygate_commercial_uploaded_file}
</xen:option>]]></replace>
    </modification>
    <modification template="user_upgrade_edit" modification_key="bdpaygate_user_upgrade_edit" description="Replace currency list with ours." execution_order="10" enabled="1" action="preg_replace">
      <find><![CDATA[#(<xen:select name="cost_currency"[^>]+>).+?</xen:select>#s]]></find>
      <replace><![CDATA[$1
	<xen:options source="$bdPaygate_currencies" />
</xen:select>]]></replace>
    </modification>
  </admin_template_modifications>
  <code_events>
    <event event_id="load_class_bdpaygate_processor"><![CDATA[<p>Called when instantiating a processor. This event can be used to extend the class that will be instantiated dynamically.</p>

<p>Callback signature:</p>
<blockquote><code>$class, <em>array</em> &$extend</code></blockquote>

<p>Arguments:</p>
<ol>
	<li><code><em>string</em> $class</code> - the name of the class to be created</li>
	<li><code><em>array</em> &$extend</code> - a modifiable list of classes that wish to extend the class. See below.</li>
</ol>

<p>To use this event properly, determine if the class is one you want to extend. If so, add a new entry to $extend with the name of the class that should extend it. This class MUST be defined as follows:</p>

<pre>class My_Class_Name extends XFCP_My_Class_Name
{
	// functionality to extend/override
}</pre>

<p>This class must extend the non-existent XFCP_x class. This will be resolved at run time.</p>]]></event>
  </code_events>
  <code_event_listeners>
    <listener event_id="bdshop_stock_pricing_get_systems" execute_order="10" callback_class="bdPaygate_Listener" callback_method="bdshop_stock_pricing_get_systems" active="1" hint="" description=""/>
    <listener event_id="file_health_check" execute_order="10" callback_class="bdPaygate_Listener" callback_method="file_health_check" active="1" hint="" description=""/>
    <listener event_id="init_dependencies" execute_order="10" callback_class="bdPaygate_Listener" callback_method="init_dependencies" active="1" hint="" description=""/>
    <listener event_id="load_class_controller" execute_order="10" callback_class="bdPaygate_Listener" callback_method="load_class" active="1" hint="" description=""/>
    <listener event_id="load_class_datawriter" execute_order="10" callback_class="bdPaygate_Listener" callback_method="load_class" active="1" hint="" description=""/>
    <listener event_id="load_class_model" execute_order="10" callback_class="bdPaygate_Listener" callback_method="load_class" active="1" hint="" description=""/>
    <listener event_id="load_class_view" execute_order="10" callback_class="bdPaygate_Listener" callback_method="load_class" active="1" hint="" description=""/>
  </code_event_listeners>
  <cron/>
  <email_templates>
    <template title="bdpaygate_failure">
      <subject><![CDATA[{xen:phrase bdpaygate_failed_transaction_x, 'transactionId={$transactionId}'}]]></subject>
      <body_text><![CDATA[{xen:phrase bdpaygate_failed_transaction_text,
	'processorId={$processorId}',
	'transactionId={$transactionId}',
	'logType={$logType}',
	'logMessage={$logMessage}',
	'logDetails={$logDetails}',
	'boardTitle={$xenOptions.boardTitle}',
	'link={xen:adminlink canonical:logs/bdpaygate, '', 'id={$logId}'}'
}]]></body_text>
      <body_html><![CDATA[]]></body_html>
    </template>
  </email_templates>
  <email_template_modifications/>
  <optiongroups>
    <group group_id="bdPaygate" display_order="9999" debug_only="0"/>
    <option option_id="bdPaygate0_emailOnFailure" edit_format="textbox" data_type="string" can_backup="1">
      <default_value></default_value>
      <edit_format_params></edit_format_params>
      <sub_options></sub_options>
      <relation group_id="bdPaygate" display_order="1000"/>
      <relation group_id="debug" display_order="210"/>
    </option>
    <option option_id="bdPaygate0_sandboxMode" edit_format="onoff" data_type="unsigned_integer" can_backup="1">
      <default_value></default_value>
      <edit_format_params></edit_format_params>
      <sub_options></sub_options>
      <relation group_id="bdPaygate" display_order="1000"/>
      <relation group_id="debug" display_order="210"/>
    </option>
    <option option_id="bdPaygate_enabledCurrencies" edit_format="callback" data_type="array" can_backup="1" validation_class="bdPaygate_Option" validation_method="verifyEnabledCurrencies">
      <default_value>a:1:{s:8:"_default";i:1;}</default_value>
      <edit_format_params>bdPaygate_Option::renderEnabledCurrencies</edit_format_params>
      <sub_options>*</sub_options>
      <relation group_id="bdPaygate" display_order="2000"/>
    </option>
  </optiongroups>
  <permissions>
    <permission_groups/>
    <permissions>
      <permission permission_group_id="forum" permission_id="bdPaygate_allThreads" permission_type="flag" default_value="unset" interface_group_id="forumModeratorPermissions" display_order="9999"/>
      <permission permission_group_id="general" permission_id="bdPaygate_allPurchases" permission_type="flag" default_value="unset" interface_group_id="generalModeratorPermissions" display_order="9999"/>
    </permissions>
    <interface_groups/>
  </permissions>
  <phrases>
    <phrase title="admin_navigation_bdPaygate_logs" version_id="2" version_string="0.9-dev"><![CDATA[[bd] Paygates Log]]></phrase>
    <phrase title="bdpaygate_add_buyer" version_id="19" version_string="1.3.1b"><![CDATA[Add Buyer]]></phrase>
    <phrase title="bdpaygate_buyers" version_id="19" version_string="1.3.1b"><![CDATA[Buyers]]></phrase>
    <phrase title="bdpaygate_buyer_found" version_id="1050102" version_string="1.5.1"><![CDATA[The requested user has purchased this item.]]></phrase>
    <phrase title="bdpaygate_buyer_not_found" version_id="1050102" version_string="1.5.1"><![CDATA[The requested user hasn't purchase this item.]]></phrase>
    <phrase title="bdpaygate_cannot_purchase_self_resource" version_id="9" version_string="1.0.3"><![CDATA[You cannot purchase your own resource.]]></phrase>
    <phrase title="bdpaygate_cannot_repurchase_resource" version_id="9" version_string="1.0.3"><![CDATA[You have purchased this resource already.]]></phrase>
    <phrase title="bdpaygate_commercial_uploaded_file" version_id="28" version_string="1.4.4"><![CDATA[Commercial uploaded file]]></phrase>
    <phrase title="bdpaygate_delete_buyer" version_id="26" version_string="1.4.2"><![CDATA[Delete Buyer]]></phrase>
    <phrase title="bdpaygate_delete_buyer_confirm" version_id="26" version_string="1.4.2"><![CDATA[After deletion, user will not be able to download the resource (even the old versions). Are you sure you want to revoke buyer right for {user}?]]></phrase>
    <phrase title="bdpaygate_failed_transaction_text" version_id="5" version_string="1.0-dev"><![CDATA[The following transaction has encountered problem at {boardTitle}:

Processor: {processorId}
Transaction: {transactionId}
Type: {logType}
Message: {logMessage}

The detail log is available here: {link}]]></phrase>
    <phrase title="bdpaygate_failed_transaction_x" version_id="5" version_string="1.0-dev"><![CDATA[Failed Transaction Notification: {transactionId}]]></phrase>
    <phrase title="bdpaygate_log" version_id="2" version_string="0.9-dev"><![CDATA[[bd] Paygate Log]]></phrase>
    <phrase title="bdpaygate_logs" version_id="2" version_string="0.9-dev"><![CDATA[[bd] Paygates Logs]]></phrase>
    <phrase title="bdpaygate_log_clear" version_id="2" version_string="0.9-dev"><![CDATA[Clear Log]]></phrase>
    <phrase title="bdpaygate_log_details" version_id="2" version_string="0.9-dev"><![CDATA[Details]]></phrase>
    <phrase title="bdpaygate_log_processor_info" version_id="2" version_string="0.9-dev"><![CDATA[Processor Info]]></phrase>
    <phrase title="bdpaygate_log_result" version_id="2" version_string="0.9-dev"><![CDATA[Result]]></phrase>
    <phrase title="bdpaygate_no_transaction_have_been_logged" version_id="2" version_string="0.9-dev"><![CDATA[No transaction have been logged.]]></phrase>
    <phrase title="bdpaygate_paypal_call_to_action" version_id="1" version_string="0.9-dev"><![CDATA[Pay with PayPal]]></phrase>
    <phrase title="bdpaygate_purchased" version_id="19" version_string="1.3.1b"><![CDATA[Purchased]]></phrase>
    <phrase title="bdpaygate_purchased_for" version_id="19" version_string="1.3.1b"><![CDATA[Purchased For]]></phrase>
    <phrase title="bdpaygate_purchased_resources" version_id="9" version_string="1.0.3"><![CDATA[Purchased Resources]]></phrase>
    <phrase title="bdpaygate_purchase_resource" version_id="9" version_string="1.0.3"><![CDATA[Purchase Resource]]></phrase>
    <phrase title="bdpaygate_purchase_resource_complete" version_id="26" version_string="1.4.2"><![CDATA[Thank you for purchasing.<br/>
When the payment is confirmed, you will be able to download the resource. It will also be available in <a href="{purchased_link}">Purchased Resources</a> page.]]></phrase>
    <phrase title="bdpaygate_requested_log_entry_not_found" version_id="2" version_string="0.9-dev"><![CDATA[The requested log entry could not be found.]]></phrase>
    <phrase title="bdpaygate_resource_purchase_explain" version_id="26" version_string="1.4.2"><![CDATA[You are purchasing {resource}. When your payment is confirmed, you will be able to download it. You can find all of your purchased resources in the <a href="{purchased_link}" target="_blank">{purchased_text}</a> page.]]></phrase>
    <phrase title="bdpaygate_subscription" version_id="27" version_string="1.4.3"><![CDATA[Payment Subscription]]></phrase>
    <phrase title="bdpaygate_this_commercial_upload" version_id="28" version_string="1.4.4"><![CDATA[This is a commercial upload.]]></phrase>
    <phrase title="bdpaygate_you_have_not_purchased_resources" version_id="9" version_string="1.0.3"><![CDATA[You have not purchased any resources.]]></phrase>
    <phrase title="bdpaygate_you_must_purchase_resource_to_download" version_id="9" version_string="1.0.3"><![CDATA[You must purchase the resource in order to download.]]></phrase>
    <phrase title="bdpaytate_sure_you_want_to_clear_log" version_id="2" version_string="0.9-dev"><![CDATA[Are you sure you want to clear the [bd] Paygate log?]]></phrase>
    <phrase title="option_bdPaygate0_emailOnFailure" version_id="5" version_string="1.0-dev"><![CDATA[Send Email on Failure]]></phrase>
    <phrase title="option_bdPaygate0_emailOnFailure_explain" version_id="5" version_string="1.0-dev"><![CDATA[Enter the email address that will receive a notification email if a paygate reports a failed transaction. Leave blank to disable this feature.]]></phrase>
    <phrase title="option_bdPaygate0_sandboxMode" version_id="5" version_string="1.0-dev"><![CDATA[Use Sandbox Mode for Paygates]]></phrase>
    <phrase title="option_bdPaygate0_sandboxMode_explain" version_id="3" version_string="1.0-dev"><![CDATA[Turn on this option to test installed paygates. Most system support sandboxing (test transactions without actually transferring money) but you should always check the document before making a payment to prevent financial loss.]]></phrase>
    <phrase title="option_bdPaygate_enabledCurrencies" version_id="22" version_string="1.3.3"><![CDATA[Enabled Currencies]]></phrase>
    <phrase title="option_bdPaygate_enabledCurrencies_explain" version_id="22" version_string="1.3.3"><![CDATA[]]></phrase>
    <phrase title="option_group_bdPaygate" version_id="22" version_string="1.3.3"><![CDATA[[bd] Paygates]]></phrase>
    <phrase title="option_group_bdPaygate_description" version_id="22" version_string="1.3.3"><![CDATA[]]></phrase>
    <phrase title="permission_forum_bdPaygate_allThreads" version_id="31" version_string="1.4.5c"><![CDATA[[bd] Paygates: Access All Resource Discussions]]></phrase>
    <phrase title="permission_general_bdPaygate_allPurchases" version_id="26" version_string="1.4.2"><![CDATA[[bd] Paygates: Access All Purchases]]></phrase>
  </phrases>
  <route_prefixes/>
  <style_properties/>
  <templates>
    <template title="bdpaygate.css" version_id="28" version_string="1.4.4"><![CDATA[#ctrl_bdpaygate_commercial_local_Container,
#ctrl_bdpaygate_commercial_local_Disabler
{
	padding-left: 20px;
}

#ctrl_bdpaygate_price
{
	margin-left: 5px;
	width: 75px;
	box-sizing: border-box;
}

#ctrl_bdpaygate_currency
{
	margin-left: 5px;
	width: 65px;
	box-sizing: border-box;
}

.bdpaygate_resource_buyers .memberListItem .extra
{
	text-align: right;
}]]></template>
    <template title="bdpaygate_account_upgrades_form" version_id="27" version_string="1.4.3"><![CDATA[<div class="upgradeForm">
	<xen:if hascontent="true">
		<div class="cost">{$upgrade.costPhrase}</div>
		<xen:contentcheck>
			<xen:foreach loop="$upgrade.paymentForms" key="$processorId" value="$form">
				<div id="{$processorId}">{xen:raw $form}</div>
			</xen:foreach>
		</xen:contentcheck>
	</xen:if>
</div>]]></template>
    <template title="bdpaygate_account_upgrades_purchased_link" version_id="27" version_string="1.4.3"><![CDATA[<xen:if is="{$upgrade.bdPaygate_subscriptionLink}">
	<a href="{xen:raw $upgrade.bdPaygate_subscriptionLink}" class="button">{xen:phrase bdpaygate_subscription}</a>
</xen:if>]]></template>
    <template title="bdpaygate_resources_tab_links" version_id="9" version_string="1.0.3"><![CDATA[<xen:if is="{$visitor.user_id}"><li><a href="{xen:link resources/purchased}">{xen:phrase bdpaygate_purchased_resources}</a></li></xen:if>]]></template>
    <template title="bdpaygate_resource_add" version_id="29" version_string="1.4.5"><![CDATA[<xen:require css="bdpaygate.css" />

<xen:if is="{$category.bdpaygate_allow_commercial_local}">
	<xen:if is="{$category.allow_local}">
		<li id="ctrl_bdpaygate_commercial_local_Container">
			<label>
				<input type="checkbox" class="Disabler Hider" id="ctrl_bdpaygate_commercial_local" />
				{xen:phrase bdpaygate_this_commercial_upload}
			</label>
		</li>
	</xen:if>
	<li id="ctrl_bdpaygate_commercial_local_Disabler">
		<label for="ctrl_bdpaygate_price">{xen:phrase cost}:</label>

		<input type="text" name="bdpaygate_price" id="ctrl_bdpaygate_price" class="textCtrl"
			placeholder="{xen:phrase price}" />

		<select name="bdpaygate_currency" class="textCtrl" id="ctrl_bdpaygate_currency">
			<xen:foreach loop="$bdPaygate_currencies" key="$key" value="$value">
				<option value="{$key}">{$value}</option>
			</xen:foreach>
		</select>
	</li>
</xen:if>

<xen:edithint template="resource_add" />
<xen:edithint template="bdpaygate_resource_edit" />]]></template>
    <template title="bdpaygate_resource_add_buyer" version_id="1050102" version_string="1.5.1"><![CDATA[<xen:title>{$resource.title} - {xen:phrase bdpaygate_add_buyer}</xen:title>

<form action="{xen:link resources/buyers/add, $resource}" method="post"
	  class="xenForm formOverlay AutoValidator" data-redirect="yes">

	<dl class="ctrlUnit">
		<dt><label for="ctrl_usernames">{xen:phrase user_name}:</label></dt>
		<dd>
			<input type="text" name="usernames" class="textCtrl AutoComplete" />
		</dd>
	</dl>
	
	<dl class="ctrlUnit submitUnit">
		<dt></dt>
		<dd><input type="submit" name="save" value="{xen:phrase save_changes}" accesskey="s" class="button primary" /></dd>
	</dl>

	<input type="hidden" name="_xfToken" value="{$visitor.csrf_token_page}" />
	<input type="hidden" name="_xfConfirm" value="1" />
</form>]]></template>
    <template title="bdpaygate_resource_buyers" version_id="1050102" version_string="1.5.1"><![CDATA[<xen:set var="$pageNav"><xen:pagenav perpage="{$limit}" total="{$total}" page="{$page}"
									 link="resources/buyers" linkdata="{$resource}" /></xen:set>

<xen:title>{$resource.title} - {xen:phrase bdpaygate_buyers}</xen:title>

<xen:require css="bdpaygate.css" />

<div>
	<div style="padding: 5px; text-align: right">
		<xen:if is="{$pageNav}">
			<a href="{xen:link resources/buyers/find, $resource}"
			   class="callToAction OverlayTrigger">
				<span>{xen:phrase bdpaygate_find_buyer}</span>
			</a>
		</xen:if>

		<a href="{xen:link resources/buyers/add, $resource}"
		   class="callToAction OverlayTrigger">
			<span>{xen:phrase bdpaygate_add_buyer}</span>
		</a>
	</div>

	<ol class="section memberList">
		<xen:foreach loop="$buyers" value="$user">
			<xen:include template="member_list_item">
				<xen:set var="$extraTemplate">
					<xen:datetime time="{$user.purchase_date}" class="muted"/>
					
					<xen:if is="{$user.purchased_amount} AND {$user.purchased_currency}">
						<div class="muted">
							{xen:phrase bdpaygate_purchased_for}:
							{$user.purchased_amount} {$user.purchased_currency}
						</div>
					</xen:if>

					<a href="{xen:link resources/buyers/delete, $resource,
							 'user_id={$user.user_id}'}" class="OverlayTrigger">
						{xen:phrase delete}
					</a>
				</xen:set>
			</xen:include>
		</xen:foreach>
	</ol>
	
	{xen:raw $pageNav}
</div>]]></template>
    <template title="bdpaygate_resource_delete_buyer" version_id="1050102" version_string="1.5.1"><![CDATA[<xen:title>{$resource.title} - {xen:phrase bdpaygate_delete_buyer}</xen:title>

<form action="{xen:link resources/buyers/delete, $resource}" method="post"
	  class="xenForm formOverlay AutoValidator" data-redirect="yes">

	<p>{xen:phrase bdpaygate_delete_buyer_confirm, 'user={xen:helper username, $user}'}</p>
	
	<dl class="ctrlUnit submitUnit">
		<dt></dt>
		<dd><input type="submit" name="save" value="{xen:phrase delete}" accesskey="s" class="button primary" /></dd>
	</dl>

	<input type="hidden" name="user_id" value="{$user.user_id}" />
	<input type="hidden" name="_xfToken" value="{$visitor.csrf_token_page}" />
	<input type="hidden" name="_xfConfirm" value="1" />
</form>]]></template>
    <template title="bdpaygate_resource_edit" version_id="29" version_string="1.4.5"><![CDATA[<xen:if is="empty({$resource.is_fileless}) AND empty({$resource.download_url}) AND !empty({$category.bdpaygate_allow_commercial_local})">
	<xen:require css="bdpaygate.css" />

	<fieldset>
		<dl class="ctrlUnit">
			<dt>{xen:phrase cost}:</dt>
			<dd>
				<input type="text" name="bdpaygate_price" value="{$resource.price}" id="ctrl_bdpaygate_price"
					class="textCtrl" placeholder="{xen:phrase price}" />

				<select name="bdpaygate_currency" class="textCtrl" id="ctrl_bdpaygate_currency">
					<xen:if is="{$category.allow_local}"><option value="">&nbsp;</option></xen:if>

					<xen:foreach loop="$bdPaygate_currencies" key="$key" value="$value">
						<option value="{$key}" {xen:selected '{$resource.currency} == "{$key}"'}>{$value}</option>
					</xen:foreach>
				</select>
			</dd>
		</dl>
	</fieldset>
</xen:if>]]></template>
    <template title="bdpaygate_resource_find_buyer" version_id="1050102" version_string="1.5.1"><![CDATA[<xen:title>{$resource.title} - {xen:phrase bdpaygate_find_buyer}</xen:title>

<form action="{xen:link resources/buyers/find, $resource}" method="post"
	  class="xenForm formOverlay AutoValidator" data-redirect="yes">

	<dl class="ctrlUnit">
		<dt><label for="ctrl_usernames">{xen:phrase user_name}:</label></dt>
		<dd>
			<input type="text" name="username" class="textCtrl AutoComplete AcSingle" />
		</dd>
	</dl>
	
	<dl class="ctrlUnit submitUnit">
		<dt></dt>
		<dd><input type="submit" name="save" value="{xen:phrase find}" accesskey="s" class="button primary" /></dd>
	</dl>

	<input type="hidden" name="_xfToken" value="{$visitor.csrf_token_page}" />
	<input type="hidden" name="_xfConfirm" value="1" />
</form>]]></template>
    <template title="bdpaygate_resource_purchase" version_id="26" version_string="1.4.2"><![CDATA[<xen:title>{xen:phrase bdpaygate_purchase_resource}: {$resource.title}</xen:title>

<div class="xenForm formOverlay">
	<xen:hook name="bdpaygate_resource_purchase_explain" params="{xen:array 'resource=$resource'}">
		<xen:if hascontent="true">
			<p>
				<xen:contentcheck>
				{xen:phrase bdpaygate_resource_purchase_explain,
					'resource={$resource.title}',
					'purchased_link={xen:link resources/purchased}',
					'purchased_text={xen:phrase bdpaygate_purchased_resources}'
				}
				</xen:contentcheck>
			</p>
		</xen:if>
	</xen:hook>
	
	<dl class="ctrlUnit">
		<dt>{xen:phrase cost}:</dt>
		<dd>{$resource.cost}</dd>
	</dl>

	<xen:foreach loop="$forms" value="$form">
		<dl class="ctrlUnit">
			<dt>&nbsp;</dt>
			<dd>{xen:raw $form}</dd>
		</dl>
	</xen:foreach>
</div>]]></template>
    <template title="bdpaygate_resource_purchased" version_id="19" version_string="1.3.1b"><![CDATA[<xen:title>{xen:phrase bdpaygate_purchased_resources}</xen:title>

<xen:require css="resource_list.css" />

<div class="sectionMain">
	<xen:if is="{$resources}">

		<ol class="resourceList">
		<xen:foreach loop="$resources" value="$resource">
			<xen:set var="$resource.cost"></xen:set>
			<xen:include template="resource_list_item">
				<xen:set var="$listItemExtraHtml">
					<a href="{xen:link resources/download, $resource, 'version={$resource.current_version_id}'}">
						{xen:phrase download}
					</a>
				</xen:set>
			</xen:include>
		</xen:foreach>
		</ol>

	<xen:else />
		<div class="primaryContent">{xen:phrase you_not_currently_watching_any_resources}</div>
	</xen:if>
</div>]]></template>
    <template title="bdpaygate_resource_view_tabs" version_id="1050102" version_string="1.5.1"><![CDATA[<xen:if is="{xen:helper bdPaygate_resourceIsPaid, $resource} && {$resource.canEdit}">
	<li class="resourceTabBuyers {xen:if "{$selectedTab} == 'buyers'", active}">
		<a href="{xen:link resources/buyers, $resource}">{xen:phrase bdpaygate_buyers}</a>
	</li>
</xen:if>]]></template>
  </templates>
  <public_template_modifications>
    <modification template="account_upgrades" modification_key="bdpaygate_account_upgrades_forms" description="Replace PayPal form with our forms." execution_order="10" enabled="1" action="preg_replace">
      <find><![CDATA[#<form[^>]+action="{\$payPalUrl}"[^>]+>.+?</form>#s]]></find>
      <replace><![CDATA[<xen:include template="bdpaygate_account_upgrades_form" />]]></replace>
    </modification>
    <modification template="account_upgrades" modification_key="bdpaygate_account_upgrades_purchased" description="Replace control for purchased upgrades with ours." execution_order="10" enabled="1" action="preg_replace">
      <find><![CDATA[#(<div class="upgradeForm">.+)<xen:if is="{\$upgrade.length_unit} AND {\$upgrade.recurring}">.+?</xen:if>#s]]></find>
      <replace><![CDATA[$1

<xen:include template="bdpaygate_account_upgrades_purchased_link" />]]></replace>
    </modification>
    <modification template="resource_add" modification_key="bdpaygate_resource_add" description="Insert [bd] Paygate controls for adding new resource." execution_order="10" enabled="1" action="preg_replace">
      <find><![CDATA[#(<xen:if is="{\$category.allow_local})(">.+?)(</xen:if>)#s]]></find>
      <replace><![CDATA[$1 OR {\$category.bdpaygate_allow_commercial_local}$2
<xen:include template="bdpaygate_resource_add" />
$3]]></replace>
    </modification>
    <modification template="resource_add" modification_key="bdpaygate_resource_edit" description="Insert [bd] Paygates controls for editing resource." execution_order="10" enabled="1" action="str_replace">
      <find><![CDATA[<xen:if is="{$resource.external_purchase_url}">]]></find>
      <replace><![CDATA[<xen:include template="bdpaygate_resource_edit" />

$0]]></replace>
    </modification>
    <modification template="resource_view_header" modification_key="bdpaygate_resource_purchase_button" description="Replace download button with purchase button for resource." execution_order="10" enabled="1" action="preg_replace">
      <find><![CDATA[#<li>(<label class="downloadButton {xen:if.+?</label>)</li>#s]]></find>
      <replace><![CDATA[<li>
	<xen:if is="{$resource.canDownload}">
		$1
	<xen:elseif is="{$resource.mustPurchaseToDownload} AND {$resource.canPurchase}" />
		<label class="downloadButton">
			<a href="{xen:link resources/purchase, $resource}" class="inner OverlayTrigger">
				{xen:phrase buy_now_for_x, 'cost={$resource.cost}'}
				<small class="minorText">{xen:number $resource.attachment.file_size, 'size'} .{$resource.attachment.extension}</small>
			</a>
		</label>
	<xen:else />
		$1
	</xen:if>
</li>]]></replace>
    </modification>
    <modification template="resource_view_tabs" modification_key="bdpaygate_resource_view_tabs" description="Insert Buyer tab for resource owner." execution_order="10" enabled="1" action="str_replace">
      <find><![CDATA[</xen:hook>]]></find>
      <replace><![CDATA[<xen:include template="bdpaygate_resource_view_tabs" />

$0]]></replace>
    </modification>
    <modification template="resources_tab_links" modification_key="bdpaygate_resources_tab_links" description="Insert purchased link." execution_order="10" enabled="1" action="str_replace">
      <find><![CDATA[</ul>]]></find>
      <replace><![CDATA[<xen:include template="bdpaygate_resources_tab_links" />

$0]]></replace>
    </modification>
  </public_template_modifications>
  <bb_code_media_sites/>
  <bb_codes/>
</addon>
